# Malware-Classification-using-Machine-Learning-with-Graphs

The following is the code implementation of [Learning Discriminative Representations for Malware Family Classification](https://link.springer.com/chapter/10.1007/978-3-031-27409-1_121).

## Introduction
In this research, we used Machine Learning on Graphs methods namely Graph2Vec and GL2Vec to generate expressive low-dimensional vectors of malware behavior graphs. These vectors, which capture the different structural properties of the behavior graphs, are then used for downstream classification task.

## Dataset
From the [Malrec Dataset](https://giantpanda.gtisc.gatech.edu/malrec/dataset/), we collected 7000 malware samples from 14 differ-ent families (500 malware per family). We confirmed their assigned families by majority voting between the antivirus software correctly identifying the samples as malicious.

## Method
We parse malware system call traces and generate behavior graphs based on their data dependency.
![alt text](https://github.com/AymanELS/Malware-Classification-using-Machine-Learning-with-Graphs/blob/main/Images/trace_to_graph.JPG)
Then we use the following methods Graph2Vec [\[1\]](https://arxiv.org/abs/1707.05005) and GL2Vec [\[2\]](https://link.springer.com/chapter/10.1007/978-3-030-36718-3_1) to embedd the behavior graphs into a lower dimensional space. These embedding are then used as feature vectors to classify malware behavior graphs into different families.
Both these methods are based on the Weisfeiler-Lehman (WL) relabeling strategy and Skip-Gram Neural Neworks.

![alt text](https://github.com/AymanELS/Malware-Classification-using-Machine-Learning-with-Graphs/blob/main/Images/graph2vec.PNG)
Source:  [\[1\]](https://arxiv.org/abs/1707.05005)

![alt text](https://github.com/AymanELS/Malware-Classification-using-Machine-Learning-with-Graphs/blob/main/Images/Weisfeiler-Lehman.JPG)
WL relabeling strategy. Also called WL coloring method [\[2\]](https://link.springer.com/chapter/10.1007/978-3-030-36718-3_1) 

## Results
We summarize the results achieved using our approach in the following table. We show the performance of two popular machine learning classifiers, Random Forest (RF) and Support Vector Machines (SVM), for malware family classification when trained with feature vectors generated by the Graph2Vec and GL2Vec.
![alt text](https://github.com/AymanELS/Malware-Classification-using-Machine-Learning-with-Graphs/blob/main/Images/Results.JPG)

The Random Forest classifer acheived the best detection rate of at least 98% for each of the 14 malware families in the dataset.
![alt text](https://github.com/AymanELS/Malware-Classification-using-Machine-Learning-with-Graphs/blob/main/Images/Gl2Vec_CM_RF.png)
Figure: Multiclass Confusion Matrix of Random Forest trained with GL2vec embeddings
